{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h3 class="mb-4">Welcome, {{ current_user.username }}!</h3>

{% if active_booking %}
<div class="card active-booking-card mb-4">
    <div class="card-body p-4">
        <h4 class="card-title"><i class="bi bi-check-circle-fill me-2"></i>Your Active Booking</h4>
        <p class="lead mb-1">
            <strong>Lot:</strong> {{ active_booking.lot.name }} | <strong>Spot:</strong> {{ active_booking.spot.spot_number }}
        </p>
        <p>
            <i class="bi bi-clock me-1"></i> Parked At: {{ active_booking.start_time.strftime('%Y-%m-%d %H:%M') }}
        </p>
        <a href="{{ url_for('release_spot', booking_id=active_booking.id) }}" class="btn btn-light fw-bold"><i class="bi bi-box-arrow-up-right me-2"></i>Release Spot & Pay</a>
    </div>
</div>
{% else %}
<h4><i class="bi bi-search me-2"></i>Find a Parking Spot</h4>
<div class="row mt-3">
    {% for lot in lots %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card parking-lot-card h-100">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold">{{ lot.name }}</h5>
                <p class="text-muted"><i class="bi bi-geo-alt-fill me-1"></i>{{ lot.address }}</p>
                <div class="mt-auto">
                    <p class="fs-5 mb-2"><i class="bi bi-tags-fill me-2"></i><strong>${{ "%.2f"|format(lot.price_per_hour) }}</strong><small>/hour</small></p>
                    <p class="fs-5 mb-3"><i class="bi bi-p-square-fill me-2"></i><strong>{{ lot.available_spots }}</strong><small> / {{ lot.capacity }} available</small></p>
                    {% if lot.available_spots > 0 %}
                    <a href="{{ url_for('book_spot', lot_id=lot.id) }}" class="btn btn-primary w-100">Book Now</a>
                    {% else %}
                    <button class="btn btn-secondary w-100" disabled>Full</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <p>No parking lots have been added yet.</p>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
